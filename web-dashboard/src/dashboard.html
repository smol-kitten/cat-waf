<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CatWAF üê± - Dashboard</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üê±</text></svg>">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <span class="logo-icon">üê±</span>
                    <span class="logo-text">CatWAF</span>
                </div>
                <div class="logo-subtitle">Purr-tecting your sites</div>
            </div>
            
            <nav class="sidebar-nav">
                <a href="#" class="nav-item active" data-page="overview">
                    <span class="nav-icon">üìä</span>
                    <span class="nav-text">Overview</span>
                </a>
                <a href="#" class="nav-item" data-page="sites">
                    <span class="nav-icon">üåê</span>
                    <span class="nav-text">Sites</span>
                </a>
                <a href="#" class="nav-item" data-page="site-editor" style="display: none;">
                    <span class="nav-icon">‚úèÔ∏è</span>
                    <span class="nav-text">Edit Site</span>
                </a>
                <a href="#" class="nav-item" data-page="bans">
                    <span class="nav-icon">üö´</span>
                    <span class="nav-text">Bans</span>
                </a>
                <a href="#" class="nav-item" data-page="security">
                    <span class="nav-icon">üõ°Ô∏è</span>
                    <span class="nav-text">Security Events</span>
                </a>
                <a href="#" class="nav-item" data-page="modsecurity">
                    <span class="nav-icon">üîí</span>
                    <span class="nav-text">ModSecurity</span>
                </a>
                <a href="#" class="nav-item" data-page="bots">
                    <span class="nav-icon">ü§ñ</span>
                    <span class="nav-text">Bot Protection</span>
                </a>
                <a href="#" class="nav-item" data-page="bot-whitelist">
                    <span class="nav-icon">üéØ</span>
                    <span class="nav-text">Bot Whitelist</span>
                </a>
                <a href="#" class="nav-item" data-page="telemetry">
                    <span class="nav-icon">‚ö°</span>
                    <span class="nav-text">Performance</span>
                </a>
                <a href="#" class="nav-item" data-page="rsl">
                    <span class="nav-icon">üîê</span>
                    <span class="nav-text">RSL Licensing</span>
                </a>

                <a href="#" class="nav-item" data-page="logs">
                    <span class="nav-icon">üìù</span>
                    <span class="nav-text">Logs</span>
                </a>
                <a href="#" class="nav-item" data-page="settings">
                    <span class="nav-icon">‚öôÔ∏è</span>
                    <span class="nav-text">Settings</span>
                </a>
            </nav>

            <div class="sidebar-footer">
                <div class="cat-status">
                    <div class="cat-text">All systems purring!</div>
                    <div class="version-text" style="font-size: 0.75rem; color: var(--text-muted); margin-top: 0.5rem; text-align: center;">
                        v1.5.0 | Nya~
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="header-left">
                    <h1 class="page-title">Dashboard</h1>
                    <div class="breadcrumbs">
                        <span class="breadcrumb">Home</span>
                        <span class="breadcrumb-separator">/</span>
                        <span class="breadcrumb active">Overview</span>
                    </div>
                </div>
                <div class="header-right">
                    <button class="header-btn" id="refreshBtn">
                        <span>üîÑ</span>
                        <span>Refresh</span>
                    </button>
                    <div class="api-status" id="apiStatus">
                        <span class="status-dot"></span>
                        <span class="status-text">Connected</span>
                    </div>
                </div>
            </header>

            <!-- Content Area -->
            <div class="content" id="mainContent">
                <!-- Overview Page (default) -->
                <div class="page active" id="overview-page">
                    <!-- Stats Cards -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-header">
                                <span class="stat-icon">üìä</span>
                                <span class="stat-label">Total Requests</span>
                            </div>
                            <div class="stat-value" id="totalRequests">Loading...</div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-header">
                                <span class="stat-icon">üö´</span>
                                <span class="stat-label">Blocked</span>
                            </div>
                            <div class="stat-value" id="blockedRequests">Loading...</div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-header">
                                <span class="stat-icon">üë•</span>
                                <span class="stat-label">Unique IPs</span>
                            </div>
                            <div class="stat-value" id="uniqueIps">Loading...</div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-header">
                                <span class="stat-icon">üîí</span>
                                <span class="stat-label">Active Bans</span>
                            </div>
                            <div class="stat-value" id="activeBans">Loading...</div>
                        </div>
                    </div>

                    <!-- Charts Row -->
                    <div class="charts-row">
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3>Traffic Over Time</h3>
                                <small style="color: var(--text-muted); margin-left: 10px;">üí° Click on any bar to analyze that hour</small>
                                <select class="time-range" id="timeRange">
                                    <option value="1h">Last Hour</option>
                                    <option value="24h" selected>Last 24 Hours</option>
                                    <option value="7d">Last 7 Days</option>
                                    <option value="30d">Last 30 Days</option>
                                </select>
                            </div>
                            <div class="chart-container">
                                <canvas id="trafficChart" style="cursor: pointer;"></canvas>
                            </div>
                        </div>

                        <div class="chart-card">
                            <div class="chart-header">
                                <h3>Request Status Distribution</h3>
                            </div>
                            <div class="chart-container">
                                <canvas id="statusChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="activity-section">
                        <div class="section-header">
                            <h3>Recent Security Events</h3>
                            <button class="btn-secondary" onclick="showPage('security')">View All</button>
                        </div>
                        <div class="activity-list" id="recentEvents">
                            <div class="activity-item loading">Loading events...</div>
                        </div>
                    </div>
                </div>

                <!-- Sites Page -->
                <div class="page" id="sites-page">
                    <div class="page-header">
                        <h2>Managed Sites</h2>
                        <div style="display: flex; gap: 0.75rem;">
                            <button class="btn-secondary" onclick="exportSites()" title="Export all sites to JSON">
                                <span>üì•</span>
                                <span>Export</span>
                            </button>
                            <button class="btn-secondary" onclick="showImportModal()" title="Import sites from JSON">
                                <span>üì§</span>
                                <span>Import</span>
                            </button>
                            <button class="btn-secondary" onclick="detectCloudflareZones()" title="Auto-detect Cloudflare zones for all sites">
                                <span>‚òÅÔ∏è</span>
                                <span>Detect CF Zones</span>
                            </button>
                            <button class="btn-secondary" onclick="regenerateAllConfigs()" title="Regenerate all NGINX configurations">
                                <span>üîÑ</span>
                                <span>Regenerate All Configs</span>
                            </button>
                            <button class="btn-primary" onclick="showAddSiteModal()">
                                <span>‚ûï</span>
                                <span>Add Site</span>
                            </button>
                        </div>
                    </div>
                    <div class="sites-grid" id="sitesGrid">
                        <div class="loading-spinner">Loading sites...</div>
                    </div>
                </div>

                <!-- Bans Page -->
                <div class="page" id="bans-page">
                    <div class="page-header">
                        <h2>IP Bans</h2>
                        <button class="btn-primary" onclick="showBanModal()">
                            <span>üö´</span>
                            <span>Ban IP</span>
                        </button>
                    </div>
                    <div class="filter-bar">
                        <select class="filter-select" id="banFilter" onchange="loadBans()">
                            <option value="active">Active Bans</option>
                            <option value="permanent">Permanent Bans</option>
                            <option value="expired">Expired Bans</option>
                        </select>
                    </div>
                    <div class="table-container" id="bansTable">
                        <div class="loading-spinner">Loading bans...</div>
                    </div>
                </div>

                <!-- Security Page -->
                <div class="page" id="security-page">
                    <div class="page-header">
                        <h2>Security Events</h2>
                    </div>

                    <!-- Combined Security Summary -->
                    <div class="security-summary-card">
                        <h3>üõ°Ô∏è Security Overview (Last 24 Hours)</h3>
                        <div class="security-summary-grid">
                            <div class="security-metric">
                                <div class="security-metric-value" id="summary-modsec-blocks">-</div>
                                <div class="security-metric-label">ModSecurity Blocks</div>
                            </div>
                            <div class="security-metric">
                                <div class="security-metric-value" id="summary-bot-blocks">-</div>
                                <div class="security-metric-label">Bot Blocks</div>
                            </div>
                            <div class="security-metric">
                                <div class="security-metric-value" id="summary-active-bans">-</div>
                                <div class="security-metric-label">Active IP Bans</div>
                            </div>
                            <div class="security-metric">
                                <div class="security-metric-value" id="summary-auto-bans">-</div>
                                <div class="security-metric-label">Auto-Bans Today</div>
                            </div>
                        </div>
                        
                        <!-- Auto-Ban Settings -->
                        <div class="auto-ban-settings">
                            <div class="toggle-container">
                                <label class="toggle">
                                    <input type="checkbox" id="enableAutoBan" onchange="updateAutoBanSettings()">
                                    <span class="toggle-slider"></span>
                                </label>
                                <span style="margin-left: 0.5rem; font-weight: 600;">Enable Auto-Ban (‚â•5 blocks in 5 min)</span>
                            </div>
                            <div class="toggle-container">
                                <label class="toggle">
                                    <input type="checkbox" id="excludeCloudflare" onchange="updateAutoBanSettings()">
                                    <span class="toggle-slider"></span>
                                </label>
                                <span style="margin-left: 0.5rem; font-weight: 600;">Exclude Cloudflare IPs</span>
                            </div>
                        </div>
                    </div>

                    <div class="filter-bar">
                        <select class="filter-select" id="severityFilter" onchange="loadSecurityEvents()">
                            <option value="">All Severities</option>
                            <option value="CRITICAL">Critical</option>
                            <option value="WARNING">Warning</option>
                            <option value="NOTICE">Notice</option>
                        </select>
                    </div>
                    <div class="events-list" id="securityEvents">
                        <div class="loading-spinner">Loading events...</div>
                    </div>
                </div>

                <!-- Analytics Page -->
                <div class="page" id="analytics-page">
                    <div class="page-header">
                        <h2>Analytics & Insights</h2>
                    </div>
                    <div class="analytics-grid">
                        <div class="analytics-card">
                            <h3>Top Domains</h3>
                            <div id="topDomains" class="list-container">Loading...</div>
                        </div>
                        <div class="analytics-card">
                            <h3>Top IPs</h3>
                            <div id="topIps" class="list-container">Loading...</div>
                        </div>
                        <div class="analytics-card">
                            <h3>Geographic Distribution</h3>
                            <div id="geoDistribution" class="list-container">Loading...</div>
                        </div>
                        <div class="analytics-card">
                            <h3>Attack Types</h3>
                            <div id="attackTypes" class="list-container">Loading...</div>
                        </div>
                    </div>
                </div>

                <!-- RSL Licensing Page -->
                <div class="page" id="rsl-page">
                    <div class="page-header">
                        <h2>üîê RSL Licensing</h2>
                        <p class="page-subtitle">Manage content licensing with Really Simple Licensing (RSL)</p>
                    </div>
                    
                    <!-- RSL Tabs -->
                    <div class="tabs">
                        <button class="tab active" data-tab="rsl-overview">üìä Overview</button>
                        <button class="tab" data-tab="rsl-licenses">üìú Licenses</button>
                        <button class="tab" data-tab="rsl-clients">üë• Clients</button>
                        <button class="tab" data-tab="rsl-tokens">üéüÔ∏è Tokens</button>
                        <button class="tab" data-tab="rsl-settings">‚öôÔ∏è Settings</button>
                    </div>
                    
                    <!-- RSL Overview Tab -->
                    <div class="tab-content active" id="rsl-overview-tab">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-label">Total Licenses</div>
                                <div class="stat-value" id="rslLicenseCount">0</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Active Clients</div>
                                <div class="stat-value" id="rslClientCount">0</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Active Tokens</div>
                                <div class="stat-value" id="rslTokenCount">0</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Requests (24h)</div>
                                <div class="stat-value" id="rslRequestCount">0</div>
                            </div>
                        </div>
                        
                        <div class="card" style="margin-top: 1.5rem;">
                            <div class="card-header">
                                <h3>Quick Actions</h3>
                            </div>
                            <div class="card-body">
                                <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                                    <a href="/cat-waf/rsl-builder" target="_blank" class="btn-primary">
                                        üîß Open RSL Builder
                                    </a>
                                    <button class="btn-secondary" onclick="showAddLicenseModal()">
                                        ‚ûï Create License
                                    </button>
                                    <button class="btn-secondary" onclick="loadRSLStats()">
                                        üîÑ Refresh Stats
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card" style="margin-top: 1.5rem;">
                            <div class="card-header">
                                <h3>What is RSL?</h3>
                            </div>
                            <div class="card-body">
                                <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                                    RSL (Really Simple Licensing) is an XML standard for declaring licensing terms for your digital content. 
                                    It helps you control how AI systems, search engines, and other automated systems interact with your content.
                                </p>
                                <ul style="color: var(--text-secondary); padding-left: 1.5rem;">
                                    <li><strong>Prohibit AI Training</strong> - Block AI systems from training on your content</li>
                                    <li><strong>Require Licenses</strong> - Require payment or licensing for content access</li>
                                    <li><strong>Per-Crawl Pricing</strong> - Charge for each crawl or scrape request</li>
                                    <li><strong>User Type Restrictions</strong> - Allow commercial vs non-commercial use</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <!-- RSL Licenses Tab -->
                    <div class="tab-content" id="rsl-licenses-tab">
                        <div class="card-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <h3>License Configurations</h3>
                            <button class="btn-primary" onclick="showAddLicenseModal()">‚ûï Add License</button>
                        </div>
                        <div id="rslLicensesList" class="list-container">
                            <div class="loading-spinner">Loading licenses...</div>
                        </div>
                    </div>
                    
                    <!-- RSL Clients Tab -->
                    <div class="tab-content" id="rsl-clients-tab">
                        <div class="card-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <h3>Registered Clients</h3>
                        </div>
                        <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                            Clients are AI systems, crawlers, or applications that have registered to access your content under RSL licenses.
                        </p>
                        <div id="rslClientsList" class="list-container">
                            <div class="loading-spinner">Loading clients...</div>
                        </div>
                    </div>
                    
                    <!-- RSL Tokens Tab -->
                    <div class="tab-content" id="rsl-tokens-tab">
                        <div class="card-header" style="margin-bottom: 1rem;">
                            <h3>Issued License Tokens</h3>
                        </div>
                        <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                            License tokens are issued to approved clients and grant access to your content under specific terms.
                        </p>
                        <div id="rslTokensList" class="list-container">
                            <div class="loading-spinner">Loading tokens...</div>
                        </div>
                    </div>
                    
                    <!-- RSL Settings Tab -->
                    <div class="tab-content" id="rsl-settings-tab">
                        <div class="card">
                            <div class="card-header">
                                <h3>Global RSL Settings</h3>
                            </div>
                            <div class="card-body">
                                <div class="form-group">
                                    <label class="toggle-label">
                                        <input type="checkbox" id="rslEnabled" onchange="saveRSLSettings()">
                                        <span>Enable RSL Globally</span>
                                    </label>
                                    <small style="color: var(--text-muted); display: block; margin-top: 0.5rem;">
                                        When enabled, RSL documents will be served for all sites
                                    </small>
                                </div>
                                
                                <div class="form-group" style="margin-top: 1.5rem;">
                                    <label>License Server Mode</label>
                                    <select id="rslServerMode" class="input-field" onchange="toggleServerModeUI()">
                                        <option value="inject">Inject on Sites (use /cat-waf/rsl/olp/)</option>
                                        <option value="external">External Server (custom URL)</option>
                                    </select>
                                    <small style="color: var(--text-muted);">
                                        Choose how OLP endpoints are exposed to clients
                                    </small>
                                </div>
                                
                                <div class="form-group" style="margin-top: 1.5rem;" id="externalServerGroup" style="display: none;">
                                    <label>External License Server URL</label>
                                    <input type="url" id="rslLicenseServerUrl" class="input-field" placeholder="https://license.yourdomain.com">
                                    <small style="color: var(--text-muted);">
                                        URL for external OLP server (only if using external mode)
                                    </small>
                                </div>
                                
                                <div class="form-group" style="margin-top: 1.5rem;">
                                    <label>Default Permitted Uses</label>
                                    <div class="checkbox-grid" style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                                        <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; background: var(--bg-secondary); border-radius: 6px;">
                                            <input type="checkbox" name="rsl_permit" value="search" checked> Search
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; background: var(--bg-secondary); border-radius: 6px;">
                                            <input type="checkbox" name="rsl_permit" value="ai-index"> AI Index
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; background: var(--bg-secondary); border-radius: 6px;">
                                            <input type="checkbox" name="rsl_permit" value="ai-input"> AI Input
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; background: var(--bg-secondary); border-radius: 6px;">
                                            <input type="checkbox" name="rsl_permit" value="ai-train"> AI Train
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="form-group" style="margin-top: 1.5rem;">
                                    <label>Default Prohibited Uses</label>
                                    <div class="checkbox-grid" style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                                        <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; background: var(--bg-secondary); border-radius: 6px;">
                                            <input type="checkbox" name="rsl_prohibit" value="ai-train" checked> AI Training
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; background: var(--bg-secondary); border-radius: 6px;">
                                            <input type="checkbox" name="rsl_prohibit" value="ai-all"> All AI
                                        </label>
                                    </div>
                                </div>
                                
                                <button class="btn-primary" style="margin-top: 1.5rem;" onclick="saveRSLSettings()">
                                    üíæ Save Settings
                                </button>
                            </div>
                        </div>
                        
                        <div class="card" style="margin-top: 1.5rem;">
                            <div class="card-header">
                                <h3>üîî Webhooks</h3>
                            </div>
                            <div class="card-body">
                                <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                                    Configure webhooks to receive notifications when RSL events occur (client registration, token issuance, etc.)
                                </p>
                                
                                <div class="form-group">
                                    <label>Webhook URL</label>
                                    <input type="url" id="rslWebhookUrl" class="input-field" placeholder="https://your-server.com/webhook">
                                    <small style="color: var(--text-muted);">
                                        Endpoint to receive POST requests for RSL events
                                    </small>
                                </div>
                                
                                <div class="form-group" style="margin-top: 1rem;">
                                    <label>Webhook Secret</label>
                                    <div style="display: flex; gap: 0.5rem;">
                                        <input type="password" id="rslWebhookSecret" class="input-field" placeholder="HMAC signing secret">
                                        <button class="btn-secondary" onclick="generateWebhookSecret()">üîÑ Generate</button>
                                    </div>
                                    <small style="color: var(--text-muted);">
                                        Secret for HMAC-SHA256 signature verification
                                    </small>
                                </div>
                                
                                <div class="form-group" style="margin-top: 1rem;">
                                    <label>Enabled Events</label>
                                    <div class="checkbox-grid" style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                                        <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; background: var(--bg-secondary); border-radius: 6px;">
                                            <input type="checkbox" name="webhook_event" value="client.registered" checked> Client Registered
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; background: var(--bg-secondary); border-radius: 6px;">
                                            <input type="checkbox" name="webhook_event" value="client.approved" checked> Client Approved
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; background: var(--bg-secondary); border-radius: 6px;">
                                            <input type="checkbox" name="webhook_event" value="token.issued" checked> Token Issued
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; background: var(--bg-secondary); border-radius: 6px;">
                                            <input type="checkbox" name="webhook_event" value="token.revoked" checked> Token Revoked
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; background: var(--bg-secondary); border-radius: 6px;">
                                            <input type="checkbox" name="webhook_event" value="payment.required"> Payment Required
                                        </label>
                                    </div>
                                </div>
                                
                                <button class="btn-primary" style="margin-top: 1rem;" onclick="saveRSLWebhookSettings()">
                                    üíæ Save Webhook Settings
                                </button>
                            </div>
                        </div>
                        
                        <div class="card" style="margin-top: 1.5rem;">
                            <div class="card-header">
                                <h3>OLP Server Endpoints</h3>
                            </div>
                            <div class="card-body">
                                <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                                    When using "Inject on Sites" mode, these endpoints are available at each site with RSL enabled:
                                </p>
                                <div style="font-family: monospace; background: var(--bg-secondary); padding: 1rem; border-radius: 6px;">
                                    <div style="margin-bottom: 0.5rem;"><strong>GET</strong> /rsl.xml - RSL license document</div>
                                    <div style="margin-bottom: 0.5rem;"><strong>GET</strong> /.well-known/rsl - RSL document (well-known)</div>
                                    <div style="margin-bottom: 0.5rem;"><strong>GET</strong> /.well-known/olp-configuration - OLP metadata</div>
                                    <div style="margin-bottom: 0.5rem;"><strong>POST</strong> /cat-waf/rsl/olp/token - Request license token</div>
                                    <div style="margin-bottom: 0.5rem;"><strong>POST</strong> /cat-waf/rsl/olp/introspect - Validate token</div>
                                    <div style="margin-bottom: 0.5rem;"><strong>POST</strong> /cat-waf/rsl/olp/key - Get decryption key (EMS)</div>
                                    <div><strong>POST</strong> /cat-waf/rsl/olp/register - Register new client</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Logs Page -->
                <div class="page" id="logs-page">
                    <div class="page-header">
                        <h2>System Logs</h2>
                    </div>
                    <div class="filter-bar">
                        <select class="filter-select" id="logType" onchange="loadLogs()">
                            <option value="access">Access Logs</option>
                            <option value="modsec">ModSecurity Logs</option>
                            <option value="error">Error Logs</option>
                        </select>
                        <select class="filter-select" id="logSiteFilter" onchange="loadLogs()">
                            <option value="">All Sites</option>
                        </select>
                        <input type="number" class="filter-input" id="logLimit" value="100" min="10" max="1000" onchange="loadLogs()">
                        <button class="btn-secondary" onclick="loadLogs()">Refresh</button>
                    </div>
                    <div class="logs-container" id="logsContainer">
                        <div class="loading-spinner">Loading logs...</div>
                    </div>
                </div>

                <!-- Settings Page -->
                <div class="page" id="settings-page">
                    <div class="page-header">
                        <h2>Settings</h2>
                    </div>
                    
                    <!-- Settings Tabs -->
                    <div class="tabs">
                        <button class="tab active" data-tab="waf-settings">‚öôÔ∏è WAF Config</button>
                        <button class="tab" data-tab="telemetry-settings">üìä Telemetry</button>
                        <button class="tab" data-tab="email-settings">üìß Email</button>
                        <button class="tab" data-tab="ssl-settings">üîê SSL/TLS</button>
                        <button class="tab" data-tab="block-rules">üö´ Block Rules</button>
                        <button class="tab" data-tab="wellknown-settings">üåê Well-Known Files</button>
                        <button class="tab" data-tab="backup-settings">üíæ Backup</button>
                        <button class="tab" data-tab="dev-settings">üîß Development</button>
                    </div>
                    
                    <!-- WAF Settings Tab -->
                    <div class="tab-content active" id="waf-settings">
                        <div class="settings-card">
                            <h3>‚öôÔ∏è WAF Configuration</h3>
                            <div id="wafSettings">
                                <div class="setting-item">
                                    <label>Default Rate Limit (req/s)</label>
                                    <input type="number" id="setting-default_rate_limit" class="setting-input" value="10" min="1" max="1000">
                                </div>
                                <div class="setting-item">
                                    <label>Default Ban Duration (seconds)</label>
                                    <input type="number" id="setting-ban_duration" class="setting-input" value="3600" min="60">
                                </div>
                                <div class="setting-item">
                                    <label>ModSecurity Paranoia Level</label>
                                    <select id="setting-paranoia_level" class="setting-input">
                                        <option value="1">Level 1 (Recommended)</option>
                                        <option value="2">Level 2 (Moderate)</option>
                                        <option value="3">Level 3 (Strict)</option>
                                        <option value="4">Level 4 (Very Strict)</option>
                                    </select>
                                </div>
                                <button class="btn-primary" onclick="saveWafSettings()">Save WAF Settings</button>
                            </div>
                        </div>
                    </div>

                    <!-- Telemetry Settings Tab -->
                    <div class="tab-content" id="telemetry-settings">
                        <div class="settings-card">
                            <h3>üìä Telemetry Configuration</h3>
                            <p style="color: var(--text-muted); margin-bottom: 1.5rem;">
                                Share anonymous usage data to help improve the WAF. All data is opt-in and privacy-preserving.
                            </p>

                            <!-- System UUID -->
                            <div class="stat-card" style="margin-bottom: 1.5rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <div style="font-size: 0.9em; color: rgba(255,255,255,0.8); margin-bottom: 0.5rem;">System UUID</div>
                                        <div style="font-family: monospace; font-size: 1.1em; font-weight: 600; color: #fff;" id="telemetry_system_uuid">Loading...</div>
                                    </div>
                                    <button class="btn-secondary" onclick="copySystemUUID()" style="background: rgba(255,255,255,0.2); color: #fff; border: 1px solid rgba(255,255,255,0.3);">
                                        üìã Copy
                                    </button>
                                </div>
                            </div>

                            <!-- Opt-In -->
                            <div class="setting-item" style="border: 2px solid #10b981; border-radius: 8px; padding: 1rem; background: rgba(16, 185, 129, 0.05); margin-bottom: 1.5rem;">
                                <label class="checkbox-label" style="font-size: 1.1em; font-weight: 600;">
                                    <input type="checkbox" id="telemetry_opt_in" onchange="toggleTelemetryOptions()">
                                    <span>‚úÖ Opt-in to Telemetry Collection</span>
                                </label>
                                <div style="font-size: 0.9em; color: var(--text-muted); margin-top: 0.5rem; margin-left: 1.75rem;">
                                    Enable anonymous data collection to help improve the WAF
                                </div>
                            </div>

                            <div id="telemetry_options" style="opacity: 0.5; pointer-events: none;">
                                <!-- Collection Interval -->
                                <div class="setting-item">
                                    <label>üìÖ Collection Interval</label>
                                    <select id="telemetry_interval" class="setting-input">
                                        <option value="off">Off (No collection)</option>
                                        <option value="manual">Manual Only</option>
                                        <option value="daily" selected>Daily</option>
                                        <option value="weekly">Weekly</option>
                                        <option value="monthly">Monthly</option>
                                    </select>
                                    <div style="font-size: 0.85em; color: var(--text-muted); margin-top: 0.5rem;">
                                        Next collection: <strong id="telemetry_next_collection">Manual trigger required</strong>
                                    </div>
                                </div>

                                <!-- Data Categories -->
                                <div class="setting-item" style="margin-top: 1.5rem;">
                                    <label style="margin-bottom: 1rem; display: block; font-size: 1.05em; font-weight: 600;">üîê Privacy Controls (DNS-Based Blocking)</label>
                                    
                                    <div style="display: grid; gap: 1rem; margin-bottom: 1rem;">
                                        <div style="padding: 1rem; border: 1px solid #e5e7eb; border-radius: 8px;">
                                            <label class="checkbox-label">
                                                <input type="checkbox" id="telemetry_collect_usage">
                                                <span><strong>Usage Metrics</strong> - Traffic stats, request counts</span>
                                            </label>
                                            <div style="font-size: 0.85em; color: var(--text-muted); margin-left: 1.75rem; margin-top: 0.25rem;">
                                                Routing: <code style="background: #f3f4f6; padding: 2px 6px; border-radius: 4px;">telemetry.yourdomain.tld/catwaf/submit</code>
                                            </div>
                                        </div>

                                        <div style="padding: 1rem; border: 1px solid #e5e7eb; border-radius: 8px;">
                                            <label class="checkbox-label">
                                                <input type="checkbox" id="telemetry_collect_settings">
                                                <span><strong>Settings Metrics</strong> - Feature usage, configurations</span>
                                            </label>
                                            <div style="font-size: 0.85em; color: var(--text-muted); margin-left: 1.75rem; margin-top: 0.25rem;">
                                                Routing: <code style="background: #f3f4f6; padding: 2px 6px; border-radius: 4px;">telemetry.yourdomain.tld/catwaf/submit</code>
                                            </div>
                                        </div>

                                        <div style="padding: 1rem; border: 1px solid #e5e7eb; border-radius: 8px;">
                                            <label class="checkbox-label">
                                                <input type="checkbox" id="telemetry_collect_system">
                                                <span><strong>System Metrics</strong> - CPU, memory, disk usage</span>
                                            </label>
                                            <div style="font-size: 0.85em; color: var(--text-muted); margin-left: 1.75rem; margin-top: 0.25rem;">
                                                Routing: <code style="background: #f3f4f6; padding: 2px 6px; border-radius: 4px;">telemetry.yourdomain.tld/catwaf/submit</code>
                                            </div>
                                        </div>

                                        <div style="padding: 1rem; border: 1px solid #e5e7eb; border-radius: 8px;">
                                            <label class="checkbox-label">
                                                <input type="checkbox" id="telemetry_collect_security">
                                                <span><strong>Security Metrics</strong> - Bans, scanner detections, blocked requests</span>
                                            </label>
                                            <div style="font-size: 0.85em; color: var(--text-muted); margin-left: 1.75rem; margin-top: 0.25rem;">
                                                Routing: <code style="background: #f3f4f6; padding: 2px 6px; border-radius: 4px;">telemetry.yourdomain.tld/catwaf/submit</code>
                                            </div>
                                        </div>
                                    </div>

                                    <div style="padding: 1rem; background: #ecfdf5; border: 1px solid #10b981; border-radius: 8px; margin-top: 1rem;">
                                        <div style="font-size: 0.9em; color: #065f46;">
                                            <strong>‚úÖ Path-Based Routing:</strong> All categories use the same endpoint with path-based routing (works with standard wildcard SSL certificates).
                                        </div>
                                    </div>
                                </div>

                                <!-- 404 Collection -->
                                <div class="setting-item" style="margin-top: 1.5rem;">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="telemetry_collect_404">
                                        <span><strong>404 Path Collection</strong> - Share scanned paths for honeypot blocklist</span>
                                    </label>
                                    <div style="font-size: 0.85em; color: var(--text-muted); margin-left: 1.75rem; margin-top: 0.5rem;">
                                        Helps build community blocklists by sharing paths that attackers scan for
                                    </div>
                                    <div style="margin-left: 1.75rem; margin-top: 0.75rem;">
                                        <label style="font-size: 0.9em;">Minimum hits before reporting:</label>
                                        <input type="number" id="telemetry_min_404_hits" class="setting-input" value="5" min="1" max="100" style="max-width: 150px; margin-top: 0.25rem;">
                                    </div>
                                </div>

                                <!-- Telemetry Endpoint -->
                                <div class="setting-item" style="margin-top: 1.5rem;">
                                    <label>üåê Telemetry Server Endpoint</label>
                                    <input type="text" id="telemetry_endpoint" class="setting-input" placeholder="https://telemetry.yourdomain.tld">
                                    <div style="font-size: 0.85em; color: var(--text-muted); margin-top: 0.5rem;">
                                        Leave default to use official telemetry server, or set up your own
                                    </div>
                                </div>
                            </div>

                            <!-- Actions -->
                            <div style="display: flex; gap: 1rem; margin-top: 2rem; flex-wrap: wrap;">
                                <button class="btn-primary" onclick="saveTelemetrySettings()">üíæ Save Settings</button>
                                <button class="btn-secondary" onclick="previewTelemetryData()">üëÅÔ∏è Preview Data</button>
                                <button class="btn-secondary" onclick="submitTelemetryNow()">üì§ Submit Now</button>
                                <button class="btn-secondary" onclick="generateSiteUUIDs()">üîë Generate Site UUIDs</button>
                            </div>

                            <!-- Last Submission Info -->
                            <div style="margin-top: 2rem; padding: 1rem; background: #f9fafb; border-radius: 8px;">
                                <div style="font-size: 0.9em; color: var(--text-muted); margin-bottom: 0.5rem;">Last Submission:</div>
                                <div id="telemetry_last_submission" style="font-size: 0.95em;">Never</div>
                            </div>
                        </div>

                        <!-- Recent Submissions -->
                        <div class="settings-card" style="margin-top: 1.5rem;">
                            <h3>üìã Recent Submissions</h3>
                            <div class="table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Time</th>
                                            <th>Category</th>
                                            <th>Status</th>
                                            <th>Response</th>
                                        </tr>
                                    </thead>
                                    <tbody id="telemetry_submissions_table">
                                        <tr><td colspan="4" style="text-align: center;">No submissions yet</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Email Settings Tab -->
                    <div class="tab-content" id="email-settings">
                        <div class="settings-card">
                            <h3>üìß Email Notifications</h3>
                            <div class="setting-item">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="setting-email_enabled">
                                    <span>Enable Email Alerts</span>
                                </label>
                            </div>
                            <div class="setting-item">
                                <label>SMTP Server</label>
                                <input type="text" id="setting-smtp_server" class="setting-input" placeholder="smtp.gmail.com">
                            </div>
                            <div class="setting-item">
                                <label>SMTP Port</label>
                                <input type="number" id="setting-smtp_port" class="setting-input" placeholder="587" value="587">
                            </div>
                            <div class="setting-item">
                                <label>SMTP Username</label>
                                <input type="text" id="setting-smtp_user" class="setting-input" placeholder="alerts@example.com">
                            </div>
                            <div class="setting-item">
                                <label>SMTP Password</label>
                                <input type="password" id="setting-smtp_pass" class="setting-input">
                            </div>
                            <div class="setting-item">
                                <label>Alert Recipients (comma-separated)</label>
                                <input type="text" id="setting-alert_recipients" class="setting-input" placeholder="admin@example.com, security@example.com">
                            </div>
                            <div class="setting-item">
                                <label>Alert Threshold (attacks/hour)</label>
                                <input type="number" id="setting-alert_threshold" class="setting-input" value="10" min="1">
                            </div>
                            <button class="btn-primary" onclick="saveEmailSettings()">Save Email Settings</button>
                        </div>
                    </div>
                    
                    <!-- SSL/TLS Settings Tab -->
                    <div class="tab-content" id="ssl-settings">
                        <div class="settings-card">
                            <h3>üîê SSL/TLS Certificates (Let's Encrypt)</h3>
                            <div class="setting-item">
                                <label>ACME Email Address</label>
                                <input type="email" id="setting-acme_email" class="setting-input" placeholder="admin@example.com">
                                <small style="color: #666; margin-top: 0.5rem; display: block;">Used for certificate expiry notifications</small>
                            </div>
                            <div class="setting-item">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="setting-acme_auto_renew" checked>
                                    <span>Enable Auto-Renewal (recommended)</span>
                                </label>
                            </div>
                            <div class="setting-item">
                                <label>ACME Server</label>
                                <select id="setting-acme_server" class="setting-input">
                                    <option value="https://acme-v02.api.letsencrypt.org/directory">Let's Encrypt (Production)</option>
                                    <option value="https://acme-staging-v02.api.letsencrypt.org/directory">Let's Encrypt (Staging)</option>
                                </select>
                            </div>
                            <button class="btn-primary" onclick="saveAcmeSettings()">Save Certificate Settings</button>
                            
                            <hr style="margin: 2rem 0; border: none; border-top: 1px solid #e0e0e0;">
                            
                            <h4 style="margin-bottom: 1rem;">Certificate Management</h4>
                            <div style="margin-bottom: 1.5rem; display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <div>
                                    <button class="btn-primary" onclick="renewAllCertificates()" style="width: 100%; padding: 12px;">
                                        <span style="font-size: 1.2rem;">üîÑ</span>
                                        <span>Process All Certificates</span>
                                    </button>
                                    <p style="font-size: 0.85rem; color: #666; margin-top: 8px;">
                                        Renews existing certificates and issues new ones for domains without certificates.
                                    </p>
                                </div>
                                <div>
                                    <button class="btn-secondary" onclick="rescanAllCertificates()" style="width: 100%; padding: 12px;">
                                        <span style="font-size: 1.2rem;">üîç</span>
                                        <span>Rescan All Certificates</span>
                                    </button>
                                    <p style="font-size: 0.85rem; color: #666; margin-top: 8px;">
                                        Fixes sites using snakeoil when real certificates are available in acme.sh.
                                    </p>
                                </div>
                            </div>
                            
                            <h4 style="margin-bottom: 1rem;">Certificate Status</h4>
                            <div id="certStatusContainer" style="max-height: 500px; overflow-y: auto;">
                                <p style="color: #666;">Loading certificate information...</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Block Rules Tab -->
                    <div class="tab-content" id="block-rules">
                        <div class="settings-card" style="grid-column: 1 / -1;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                <h3>üö´ Custom Block Rules</h3>
                                <button class="btn-primary" onclick="showAddBlockRuleModal()">
                                    <span style="font-size: 1.1rem;">+</span> Add Rule
                                </button>
                            </div>
                            <p style="color: #666; margin-bottom: 1.5rem;">
                                Block access to sensitive paths like <code>/.git/config</code>, <code>/.env</code>, and more. These rules integrate with ModSecurity and appear in security events.
                            </p>
                            
                            <div class="table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Enabled</th>
                                            <th>Name</th>
                                            <th>Pattern</th>
                                            <th>Type</th>
                                            <th>Severity</th>
                                            <th>Rule ID</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="blockRulesBody">
                                        <tr><td colspan="7" style="text-align: center;">Loading...</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Well-Known Files Tab -->
                    <div class="tab-content" id="wellknown-settings">
                        <div class="settings-card" style="grid-column: 1 / -1;">
                            <h3>üåê Global Well-Known Files</h3>
                            <p style="margin-bottom: 1.5rem;">
                                Set default well-known files that apply to all sites unless overridden per-site. 
                                These files control search engine crawling, security disclosure, team credits, and advertising standards.
                            </p>
                            
                            <!-- Global Enable/Disable Toggle -->
                            <div style="background: var(--bg-secondary); padding: 1.5rem; border-radius: 8px; border: 2px solid var(--primary); margin-bottom: 1.5rem;">
                                <label style="display: flex; align-items: center; gap: 1rem; cursor: pointer; margin: 0;">
                                    <input type="checkbox" 
                                           id="wellknownGlobalEnabled" 
                                           checked
                                           style="width: 24px; height: 24px; cursor: pointer;">
                                    <div>
                                        <strong style="color: var(--text-primary); font-size: 1.1rem;">üåç Enable Well-Known Files System</strong>
                                        <div style="font-size: 0.95em; color: var(--text-muted); margin-top: 0.5rem;">
                                            When disabled, NGINX will not serve any well-known files (robots.txt, security.txt, etc.) for any site. 
                                            Enable this if you want NGINX to serve these files; individual sites can then use global defaults or their own custom versions.
                                        </div>
                                    </div>
                                </label>
                            </div>
                            
                            <div class="form-group">
                                <label>Select File:</label>
                                <select id="globalWellKnownSelector" class="form-input" onchange="loadGlobalWellKnownFile()">
                                    <option value="robots" selected>robots.txt - Search Engine Rules</option>
                                    <option value="security">security.txt - Security Contact (RFC 9116)</option>
                                    <option value="humans">humans.txt - Team Credits</option>
                                    <option value="ads">ads.txt - Authorized Sellers</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label id="globalWellKnownLabel">robots.txt Content</label>
                                <textarea id="globalWellKnownContent" class="form-input code-editor" rows="12" placeholder="User-agent: *
Allow: /

Disallow: /admin/
Disallow: /api/

Sitemap: https://example.com/sitemap.xml"></textarea>
                                <small id="globalWellKnownHelp" style="color: var(--text-muted);">Global default for all sites</small>
                            </div>
                            
                            <div style="display: flex; gap: 1rem;">
                                <button class="btn-primary" onclick="saveGlobalWellKnownFile()">
                                    <span>üíæ</span> Save Global Default
                                </button>
                                <button class="btn-secondary" onclick="loadGlobalWellKnownTemplate()">
                                    <span>üìã</span> Load Template
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Backup & Restore Tab -->
                    <div class="tab-content" id="backup-settings">
                        <div class="settings-card" style="grid-column: 1 / -1;">
                            <h3>üíæ Backup & Restore</h3>
                            <p style="color: #666; margin-bottom: 1rem;">
                                Export your CatWAF configuration, sites, and data for backup or migration. Import from a previous backup to restore your setup.
                            </p>
                            
                            <!-- Security Setting -->
                            <div style="border: 1px solid #2196f3; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
                                <label class="checkbox-label" style="display: flex; align-items: center; margin: 0;">
                                    <input type="checkbox" id="backupLocalOnly" onchange="saveBackupSettings()">
                                    <span>üîí Restrict backup access to local network only (recommended for production)</span>
                                </label>
                                <p style="margin: 0.5rem 0 0 1.5rem; font-size: 0.85rem; color: #1565c0;">
                                    When enabled, backup/import operations only work from 127.0.0.1, 10.x.x.x, 172.16-31.x.x, or 192.168.x.x
                                </p>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                                <!-- Export Section -->
                                <div>
                                    <h4>üì§ Export Backup</h4>
                                    <div id="backupInfo" style="padding: 1rem; border-radius: 8px; margin: 1rem 0; font-size: 0.9rem; color: #f5f5f5;">
                                        <p style="margin: 0.5rem 0; "><strong>Estimating backup size...</strong></p>
                                    </div>
                                    <p style="font-size: 0.85rem; margin-bottom: 1rem;">
                                        Backup includes: sites, settings, telemetry (30 days), bot detections (30 days), security events (30 days), access logs (7 days), custom rules, and rate limit presets.
                                        <br><br>
                                        <strong>Note:</strong> Certificates are NOT included in backups.
                                    </p>
                                    <button class="btn-primary" onclick="exportBackup()" style="width: 100%;">
                                        <span style="font-size: 1.2rem;">‚¨áÔ∏è</span> Download Backup
                                    </button>
                                </div>
                                
                                <!-- Import Section -->
                                <div>
                                    <h4>üì• Import Backup</h4>
                                    <div style="border: 1px solid #ffc107; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                                        <p style="margin: 0; font-size: 0.85rem; color: #856404;">
                                            ‚ö†Ô∏è <strong>Warning:</strong> Importing will modify your current configuration!
                                        </p>
                                    </div>
                                    <div style="margin: 1rem 0;">
                                        <label style="display: block; margin-bottom: 0.5rem;">Select backup file (.zip):</label>
                                        <input type="file" id="backupFile" accept=".zip" style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
                                    </div>
                                    <div style="margin: 1rem 0;">
                                        <label style="display: block; margin-bottom: 0.5rem;"><strong>Import Options:</strong></label>
                                        <label class="checkbox-label" style="display: block; margin: 0.5rem 0;">
                                            <input type="checkbox" id="import_sites" checked>
                                            <span>Sites Configuration</span>
                                        </label>
                                        <label class="checkbox-label" style="display: block; margin: 0.5rem 0;">
                                            <input type="checkbox" id="import_settings" checked>
                                            <span>Global Settings</span>
                                        </label>
                                        <label class="checkbox-label" style="display: block; margin: 0.5rem 0;">
                                            <input type="checkbox" id="import_block_rules" checked>
                                            <span>Custom Block Rules</span>
                                        </label>
                                        <label class="checkbox-label" style="display: block; margin: 0.5rem 0;">
                                            <input type="checkbox" id="import_rate_limits" checked>
                                            <span>Rate Limit Presets</span>
                                        </label>
                                        <label class="checkbox-label" style="display: block; margin: 0.5rem 0;">
                                            <input type="checkbox" id="import_telemetry">
                                            <span>üìä Telemetry Data (optional)</span>
                                        </label>
                                        <label class="checkbox-label" style="display: block; margin: 0.5rem 0;">
                                            <input type="checkbox" id="import_access_logs">
                                            <span>üìã Access Logs (optional)</span>
                                        </label>
                                        <label class="checkbox-label" style="display: block; margin: 0.5rem 0;">
                                            <input type="checkbox" id="import_bot_detections">
                                            <span>ü§ñ Bot Detections (optional)</span>
                                        </label>
                                        <label class="checkbox-label" style="display: block; margin: 0.5rem 0;">
                                            <input type="checkbox" id="import_modsec_events">
                                            <span>üõ°Ô∏è Security Events (optional)</span>
                                        </label>
                                    </div>
                                    <div style="margin: 1rem 0;">
                                        <label style="display: block; margin-bottom: 0.5rem;">Import Mode:</label>
                                        <select id="merge_mode" style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
                                            <option value="skip">Merge - Skip existing items (recommended)</option>
                                            <option value="replace">Merge - Replace existing items</option>
                                            <option value="clear">‚ö†Ô∏è Clear All - Fresh import (wipes all data & logs)</option>
                                        </select>
                                    </div>
                                    <button class="btn-primary" onclick="importBackup()" style="width: 100%;">
                                        <span style="font-size: 1.2rem;">‚¨ÜÔ∏è</span> Import Backup
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Backup & Restore Tab -->
                    <div class="tab-content" id="backup-settings">
                        <div class="settings-card" style="grid-column: 1 / -1;">
                            <h3>üíæ Backup & Restore</h3>
                            <p style="color: #666; margin-bottom: 1rem;">
                                Export your CatWAF configuration, sites, and data for backup or migration. Import from a previous backup to restore your setup.
                            </p>
                        </div>
                    </div>

                    <!-- Development Mode Tab -->
                    <div class="tab-content" id="dev-settings">
                        <div class="settings-card" style="grid-column: 1 / -1; border: 2px solid #8b5cf6;">
                            <h3 style="color: #5b21b6; font-weight: 700;">üîß Development Mode</h3>
                            <p style="margin-bottom: 1.5rem; font-weight: 500;">
                                Enable detailed debugging headers in responses to help troubleshoot backend issues. Shows backend address, response times, connection times, and more.
                            </p>
                            
                            <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; border-radius: 8px; border: 1px solid #e5e7eb;">
                                <label class="switch">
                                    <input type="checkbox" id="dev_mode_headers" onchange="saveDevModeSetting()">
                                    <span class="slider round"></span>
                                </label>
                                <div>
                                    <strong>Enable Development Headers</strong>
                                    <div style="font-size: 0.9em; color: #6b7280; margin-top: 0.25rem;">
                                        Adds X-Dev-* headers with backend debugging info (Backend-Addr, Response-Time, Connect-Time, etc.)
                                    </div>
                                </div>
                            </div>

                            <div style="margin-top: 1rem; padding: 0.75rem; background: #fef3c7; border-left: 4px solid #f59e0b; border-radius: 4px;">
                                <strong>‚ö†Ô∏è Note:</strong> Development headers expose internal backend topology. Disable in production environments for security.
                            </div>
                        </div>

                        <!-- Data Cleanup Card -->
                        <div class="settings-card" style="grid-column: 1 / -1; border: 2px solid #f59e0b; color: #fffbeb;">
                            <h3 style="color: #92400e; font-weight: 700;">üóëÔ∏è Data Cleanup</h3>
                            <p style=" margin-bottom: 1.5rem; font-weight: 500;">
                                Delete old logs and telemetry data to free up database space. Recommended to keep 30-90 days of data for analysis.
                            </p>
                            
                            <div id="cleanupStats" style="color: #ffffff; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem; border: 1px solid #e5e7eb;">
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                                    <div>
                                        <div style="font-size: 0.85em; color: #6b7280; font-weight: 600;">Access Logs</div>
                                        <div style="font-size: 1.2em; font-weight: 700; " id="cleanupAccessLogs">-</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 0.85em; color: #6b7280; font-weight: 600;">Telemetry Records</div>
                                        <div style="font-size: 1.2em; font-weight: 700; " id="cleanupTelemetry">-</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 0.85em; color: #6b7280; font-weight: 600;">Security Events</div>
                                        <div style="font-size: 1.2em; font-weight: 700; " id="cleanupModSec">-</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 0.85em; color: #6b7280; font-weight: 600;">Bot Detections</div>
                                        <div style="font-size: 1.2em; font-weight: 700; " id="cleanupBots">-</div>
                                    </div>
                                </div>
                            </div>

                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                                <div>
                                    <label>Data Age to Delete</label>
                                    <select id="cleanupDays" class="setting-input">
                                        <option value="7">Older than 7 days</option>
                                        <option value="14">Older than 14 days</option>
                                        <option value="30" selected>Older than 30 days</option>
                                        <option value="60">Older than 60 days</option>
                                        <option value="90">Older than 90 days</option>
                                        <option value="180">Older than 6 months</option>
                                        <option value="365">Older than 1 year</option>
                                    </select>
                                </div>
                            </div>

                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1.5rem;">
                                <button class="btn-secondary" onclick="cleanupData('logs')" style="background: #3b82f6;">
                                    üóëÔ∏è Clean Access Logs
                                </button>
                                <button class="btn-secondary" onclick="cleanupData('telemetry')" style="background: #8b5cf6;">
                                    üóëÔ∏è Clean Telemetry
                                </button>
                                <button class="btn-secondary" onclick="cleanupData('modsec')" style="background: #f59e0b;">
                                    üóëÔ∏è Clean Security Events
                                </button>
                                <button class="btn-primary" onclick="cleanupData('all')" style="background: #ef4444;">
                                    üóëÔ∏è Clean All Old Data
                                </button>
                            </div>

                            <div style="margin-top: 1rem; padding: 0.75rem; border-left: 4px solid #ffc107; border-radius: 4px;">
                                <strong>‚ö†Ô∏è Warning:</strong> This action cannot be undone. Make sure you have backups if needed.
                            </div>
                        </div>

                        <!-- System Reset Card -->
                        <div class="settings-card" style="grid-column: 1 / -1; border: 2px solid #ef4444;">
                            <h3 style="color: #991b1b; font-weight: 700;">‚ö†Ô∏è System Reset (Advanced)</h3>
                            <p style="margin-bottom: 1.5rem; font-weight: 500;">
                                <strong style="color: #991b1b;">Danger Zone:</strong> These actions will completely reset your WAF installation. Only use if you know what you're doing.
                            </p>
                            
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                                <div style="padding: 1rem; border-radius: 8px; border: 2px solid #fca5a5;">
                                    <h4 style="margin: 0 0 0.5rem 0; color: #7f1d1d; font-weight: 700;">üîÑ Full Reset</h4>
                                    <p style="font-size: 0.9em; margin-bottom: 1rem; font-weight: 500;">
                                        Backs up data, destroys all volumes, pulls latest images, starts fresh. <strong style="color: #991b1b;">Manual restore required.</strong>
                                    </p>
                                    <button class="btn-danger" onclick="triggerSystemReset(false)" style="width: 100%;">
                                        üí£ Full Reset
                                    </button>
                                </div>
                                
                                <div style=" padding: 1rem; border-radius: 8px; border: 2px solid #fbbf24;">
                                    <h4 style="margin: 0 0 0.5rem 0; color: #78350f; font-weight: 700;">üîÑ Reset + Auto-Restore</h4>
                                    <p style="font-size: 0.9em; margin-bottom: 1rem; font-weight: 500;">
                                        Same as Full Reset but automatically imports backup after fresh start. <strong style="color: #92400e;">Safest option.</strong>
                                    </p>
                                    <button class="btn-secondary" onclick="triggerSystemReset(true)" style="width: 100%; color: #fff; font-weight: 600;">
                                        üîÑ Reset & Restore
                                    </button>
                                </div>
                            </div>

                            <div style="margin-top: 1rem; padding: 1rem; border-left: 4px solid #ef4444; border-radius: 4px;">
                                <strong>‚õî CRITICAL WARNING:</strong> System reset will:
                                <ul style="margin: 0.5rem 0 0 1.5rem; padding: 0;">
                                    <li>Stop all containers</li>
                                    <li>Delete all Docker volumes (database, logs, configs)</li>
                                    <li>Pull latest images</li>
                                    <li>Start completely fresh</li>
                                </ul>
                                <p style="margin: 0.5rem 0 0 0; font-weight: 600;">
                                    ‚úÖ A backup is created first (will abort if backup fails)
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ModSecurity Page -->
                <div class="page" id="modsecurity-page">

                    <!-- ModSecurity Stats -->
                    <div class="stats-grid" style="margin-bottom: 30px;">
                        <div class="stat-card">
                            <div class="stat-header">
                                <span class="stat-icon">üõ°Ô∏è</span>
                                <span class="stat-label">Rules Loaded</span>
                            </div>
                            <div class="stat-value" id="modsecRulesCount">-</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-header">
                                <span class="stat-icon">üö´</span>
                                <span class="stat-label">Blocks Today</span>
                            </div>
                            <div class="stat-value danger" id="modsecBlocksToday">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-header">
                                <span class="stat-icon">‚ö†Ô∏è</span>
                                <span class="stat-label">Warnings Today</span>
                            </div>
                            <div class="stat-value warning" id="modsecWarningsToday">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-header">
                                <span class="stat-icon">üìä</span>
                                <span class="stat-label">Paranoia Level</span>
                            </div>
                            <div class="stat-value" id="modsecParanoia">1</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-header">
                                <span class="stat-icon">üõ°Ô∏è</span>
                                <span class="stat-label">ModSecurity Status</span>
                            </div>
                            <div class="stat-value" id="modsecStatus">
                                <span class="status-badge checking">Checking...</span>
                            </div>
                        </div>
                    </div>

                    <!-- Top Triggered Rules -->
                    <div class="chart-card" style="margin-bottom: 20px;">
                        <div class="chart-header">
                            <h3>Top Triggered Rules (Last 24h)</h3>
                        </div>
                        <div id="topModsecRules" class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Rule ID</th>
                                        <th>Description</th>
                                        <th>Severity</th>
                                        <th>Triggers</th>
                                    </tr>
                                </thead>
                                <tbody id="topModsecRulesBody">
                                    <tr><td colspan="4" style="text-align: center;">Loading...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Recent Events -->
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>Recent Security Events</h3>
                            <div class="filter-bar">
                                <select class="filter-select" id="modsecSeverityFilter" onchange="loadModSecEvents()">
                                    <option value="">All Severities</option>
                                    <option value="CRITICAL">Critical</option>
                                    <option value="WARNING">Warning</option>
                                    <option value="NOTICE">Notice</option>
                                </select>
                            </div>
                        </div>
                        <div id="modsecEvents" class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Time</th>
                                        <th>Location</th>
                                        <th>IP</th>
                                        <th>Rule</th>
                                        <th>Severity</th>
                                        <th>Message</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody id="modsecEventsBody">
                                    <tr><td colspan="7" style="text-align: center;">Loading...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Bot Protection Page -->
                <div class="page" id="bots-page">
                    <div class="page-header">
                        <h2>ü§ñ Bot Protection</h2>
                    </div>

                    <!-- Bot Stats -->
                    <div class="stats-grid" style="margin-bottom: 30px;">
                        <div class="stat-card">
                            <div class="stat-header">
                                <span class="stat-icon">ü§ñ</span>
                                <span class="stat-label">Bots Detected</span>
                            </div>
                            <div class="stat-value" id="botsDetected">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-header">
                                <span class="stat-icon">‚úÖ</span>
                                <span class="stat-label">Good Bots</span>
                            </div>
                            <div class="stat-value success" id="goodBots">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-header">
                                <span class="stat-icon">‚ùå</span>
                                <span class="stat-label">Bad Bots Blocked</span>
                            </div>
                            <div class="stat-value danger" id="badBots">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-header">
                                <span class="stat-icon">üìà</span>
                                <span class="stat-label">Detection Rate</span>
                            </div>
                            <div class="stat-value" id="botDetectionRate">0%</div>
                        </div>
                    </div>

                    <!-- Bot Detection Chart -->
                    <div class="chart-card" style="margin-bottom: 20px;">
                        <div class="chart-header">
                            <h3>Bot Activity (Last 24h)</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="botActivityChart"></canvas>
                        </div>
                    </div>

                    <!-- Bot Statistics -->
                    <div class="chart-card" style="margin-bottom: 20px;">
                        <div class="chart-header">
                            <h3>üìä Bot Activity Statistics</h3>
                            <small style="color: var(--text-muted);">Detections over time periods</small>
                        </div>
                        <div id="botStats" class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Bot Name</th>
                                        <th>Last Hour</th>
                                        <th>Last 24h</th>
                                        <th>Last 7d</th>
                                        <th>Action</th>
                                        <th>Last Seen</th>
                                    </tr>
                                </thead>
                                <tbody id="botStatsBody">
                                    <tr><td colspan="6" style="text-align: center;">Loading...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Recent Bot Detections -->
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>Recent Bot Detections</h3>
                        </div>
                        <div id="botDetections" class="table-container" style="max-height: 400px; overflow-y: auto;">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Time</th>
                                        <th>Bot Name</th>
                                        <th>IP Address</th>
                                        <th>User Agent</th>
                                        <th>Bot Type</th>
                                        <th>Action</th>
                                        <th>Quick Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="botDetectionsBody">
                                    <tr><td colspan="7" style="text-align: center;">Loading...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Bot Whitelist Management Page -->
                <div class="page" id="bot-whitelist-page">
                    <div class="page-header">
                        <div>
                            <h2>üéØ Bot Whitelist Management</h2>
                            <p style="color: var(--text-muted); margin-top: 0.5rem;">
                                Manage bot detection patterns and actions. Changes are applied immediately after save.
                            </p>
                        </div>
                        <button class="btn-primary" onclick="showAddBotRuleModal()">
                            <span>‚ûï</span>
                            <span>Add Bot Rule</span>
                        </button>
                    </div>

                    <!-- Bot Rules Table -->
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>Bot Rules</h3>
                            <div style="display: flex; gap: 10px;">
                                <select class="filter-select" id="botActionFilter" onchange="loadBotWhitelist()">
                                    <option value="">All Actions</option>
                                    <option value="allow">Allow</option>
                                    <option value="flag">Flag</option>
                                    <option value="block">Block</option>
                                </select>
                                <button class="btn-secondary" onclick="regenerateBotConfig()">
                                    <span>üîÑ</span>
                                    <span>Regenerate Config</span>
                                </button>
                            </div>
                        </div>
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th style="width: 50px;">Enabled</th>
                                        <th>Pattern</th>
                                        <th style="width: 120px;">Action</th>
                                        <th style="width: 80px;">Priority</th>
                                        <th>Description</th>
                                        <th style="width: 200px;">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="botWhitelistBody">
                                    <tr><td colspan="6" style="text-align: center; padding: 2rem;">Loading bot rules...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Telemetry Page -->
                <div class="page" id="telemetry-page">
                    <div class="page-header">
                        <h2>üì° Performance Telemetry</h2>
                    </div>

                    <!-- Telemetry Stats -->
                    <div class="stats-grid" style="margin-bottom: 30px; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                        <div class="stat-card">
                            <div class="stat-header">
                                <span class="stat-icon">‚ö°</span>
                                <span class="stat-label">Avg Response Time</span>
                            </div>
                            <div class="stat-value" id="avgResponseTime">0ms</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-header">
                                <span class="stat-icon">üìä</span>
                                <span class="stat-label">Median Response Time</span>
                            </div>
                            <div class="stat-value" id="medianResponseTime">0ms</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-header">
                                <span class="stat-icon">üìà</span>
                                <span class="stat-label">Requests/min</span>
                            </div>
                            <div class="stat-value" id="requestsPerMinute">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-header">
                                <span class="stat-icon">üéØ</span>
                                <span class="stat-label">Error Rate</span>
                            </div>
                            <div class="stat-value" id="errorRate">0%</div>
                        </div>
                    </div>

                    <!-- Response Time Chart -->
                    <div class="chart-card" style="margin-bottom: 20px;">
                        <div class="chart-header">
                            <h3>Response Time Distribution</h3>
                            <select class="time-range" id="telemetryTimeRange" onchange="loadTelemetryData()">
                                <option value="1h">Last Hour</option>
                                <option value="24h" selected>Last 24 Hours</option>
                                <option value="7d">Last 7 Days</option>
                            </select>
                        </div>
                        <div class="chart-container">
                            <canvas id="responseTimeChart"></canvas>
                        </div>
                    </div>

                    <!-- Slowest Endpoints -->
                    <div class="chart-card" style="margin-bottom: 20px;">
                        <div class="chart-header">
                            <h3>Slowest Endpoints</h3>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <label style="font-size: 0.9em; color: var(--text-muted);">Filter Sites:</label>
                                <button class="btn-secondary" onclick="toggleSiteFilter()" style="padding: 6px 12px; font-size: 0.85em;">
                                    üîß Manage Filter
                                </button>
                            </div>
                        </div>
                        <div id="siteFilterPanel" style="display: none; padding: 15px; color: #f8f9fa; border-radius: 8px; margin-bottom: 15px;">
                            <p style="margin: 0 0 10px 0; font-size: 0.9em; color: #6b7280;">
                                Deselect sites to hide them from "Slowest Endpoints" to reduce noise:
                            </p>
                            <div id="siteFilterCheckboxes" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 10px;">
                                <div style="text-align: center; color: #9ca3af;">Loading sites...</div>
                            </div>
                            <div style="margin-top: 10px; display: flex; gap: 10px;">
                                <button class="btn-primary" onclick="applySiteFilter()" style="padding: 8px 16px; font-size: 0.9em;">
                                    ‚úÖ Apply Filter
                                </button>
                                <button class="btn-secondary" onclick="selectAllSites()" style="padding: 8px 16px; font-size: 0.9em;">
                                    Select All
                                </button>
                                <button class="btn-secondary" onclick="deselectAllSites()" style="padding: 8px 16px; font-size: 0.9em;">
                                    Deselect All
                                </button>
                            </div>
                        </div>
                        <div id="slowestEndpoints" class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Host</th>
                                        <th>Path</th>
                                        <th>Avg Response</th>
                                        <th>P95</th>
                                        <th>P99</th>
                                        <th>Requests</th>
                                    </tr>
                                </thead>
                                <tbody id="slowestEndpointsBody">
                                    <tr><td colspan="6" style="text-align: center;">Loading...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Site Performance (similar to Backend Performance) -->
                    <div class="chart-card" style="margin-bottom: 20px;">
                        <div class="chart-header">
                            <h3>üåê Site Performance</h3>
                            <small style="color: var(--text-muted);">Performance metrics grouped by domain</small>
                        </div>
                        <div id="sitePerformance" class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Domain</th>
                                        <th>Hits</th>
                                        <th>Avg Response</th>
                                        <th>Min / Max</th>
                                        <th>Errors</th>
                                        <th>Error Rate</th>
                                    </tr>
                                </thead>
                                <tbody id="sitePerformanceBody">
                                    <tr><td colspan="6" style="text-align: center;">Loading...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Backend Performance -->
                    <div class="chart-card" style="margin-bottom: 20px;">
                        <div class="chart-header">
                            <h3>Backend Server Performance</h3>
                        </div>
                        <div id="backendPerformance" class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Backend Server</th>
                                        <th>Requests</th>
                                        <th>Avg Response</th>
                                        <th>Errors</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="backendPerformanceBody">
                                    <tr><td colspan="5" style="text-align: center;">Loading...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Top Endpoints -->
                    <div class="chart-card" style="margin-bottom: 20px;">
                        <div class="chart-header">
                            <h3>üî• Most Accessed Endpoints</h3>
                            <small style="color: var(--text-muted);">Top 10 endpoints with highest traffic</small>
                        </div>
                        <div id="topEndpoints" class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Domain</th>
                                        <th>Path</th>
                                        <th>Hits</th>
                                        <th>Avg Response</th>
                                    </tr>
                                </thead>
                                <tbody id="topEndpointsBody">
                                    <tr><td colspan="4" style="text-align: center;">Loading...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Top Error Codes -->
                    <div class="chart-card" style="margin-bottom: 20px;">
                        <div class="chart-header">
                            <h3>‚ö†Ô∏è Top HTTP Error Codes</h3>
                            <small style="color: var(--text-muted);">4xx and 5xx error distribution</small>
                        </div>
                        <div id="topErrors" class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Status Code</th>
                                        <th>Description</th>
                                        <th>Count</th>
                                        <th>Affected Domains</th>
                                        <th>Unique IPs</th>
                                    </tr>
                                </thead>
                                <tbody id="topErrorsBody">
                                    <tr><td colspan="5" style="text-align: center;">Loading...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Top 404s -->
                    <div class="chart-card" style="margin-bottom: 20px;">
                        <div class="chart-header">
                            <h3>‚ùå Most Common 404 Errors</h3>
                            <small style="color: var(--text-muted);">Top 10 missing resources</small>
                        </div>
                        <div id="top404s" class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Domain</th>
                                        <th>Path</th>
                                        <th>Hits</th>
                                        <th>Last Seen</th>
                                    </tr>
                                </thead>
                                <tbody id="top404sBody">
                                    <tr><td colspan="4" style="text-align: center;">Loading...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Recent Requests Inspector -->
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>üîç Recent Requests Inspector</h3>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <select id="recentRequestsSiteSelect" onchange="loadRecentRequests()" class="time-range" style="min-width: 200px;">
                                    <option value="">Select a site...</option>
                                </select>
                                <select id="recentRequestsLimit" onchange="loadRecentRequests()" class="time-range">
                                    <option value="10">Last 10</option>
                                    <option value="25">Last 25</option>
                                    <option value="50">Last 50</option>
                                    <option value="100">Last 100</option>
                                </select>
                            </div>
                        </div>
                        <div id="recentRequests" class="table-container" style="max-height: 600px; overflow-y: auto;">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Time</th>
                                        <th>Method</th>
                                        <th>URI</th>
                                        <th>Status</th>
                                        <th>Response Time</th>
                                        <th>Backend</th>
                                    </tr>
                                </thead>
                                <tbody id="recentRequestsBody">
                                    <tr><td colspan="6" style="text-align: center; color: #9ca3af;">Select a site to view recent requests</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Site Editor Page -->
                <div class="page" id="site-editor-page">
                    <div class="editor-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                        <div>
                            <h2 id="editorSiteTitle" style="margin: 0;">Edit Site</h2>
                            <p id="editorSiteDomain" style="color: var(--text-muted); margin: 0.5rem 0 0 0;"></p>
                        </div>
                        <div style="display: flex; gap: 1rem; align-items: center;">
                            <div id="autoSaveStatus" style="display: flex; align-items: center; gap: 0.5rem; color: var(--text-muted); font-size: 0.875rem;">
                                <span id="autoSaveIcon">üíæ</span>
                                <span id="autoSaveText">Auto-save enabled</span>
                            </div>
                            <button class="btn-secondary" onclick="verifyCurrentSiteConfig()" style="background: #17a2b8; color: white;" title="Verify configuration for issues">
                                <span>üîç</span>
                                <span>Verify Config</span>
                            </button>
                            <button class="btn-secondary" onclick="navigateToPage('sites')">
                                <span>‚Üê</span>
                                <span>Back to Sites</span>
                            </button>
                        </div>
                    </div>

                    <!-- Editor Tabs -->
                    <div class="tabs-container" style="margin-bottom: 2rem;">
                        <div class="tabs">
                            <button class="tab-btn active" data-editor-tab="general">General</button>
                            <button class="tab-btn" data-editor-tab="security">Security</button>
                            <button class="tab-btn" data-editor-tab="performance">Performance</button>
                            <button class="tab-btn" data-editor-tab="backends">Backends</button>
                            <button class="tab-btn" data-editor-tab="ssl">SSL/TLS</button>
                            <button class="tab-btn" data-editor-tab="access">Access Control</button>
                            <button class="tab-btn" data-editor-tab="error-pages">Error Pages</button>
                            <button class="tab-btn" data-editor-tab="wellknown">Well-Known Files</button>
                            <button class="tab-btn" data-editor-tab="rsl">RSL/Licensing</button>
                            <button class="tab-btn" data-editor-tab="advanced">Advanced</button>
                        </div>
                    </div>

                    <!-- Editor Content -->
                    <div id="editorContent"></div>
                </div>

                <!-- Add Site Page -->
                <div class="page" id="add-site-page">
                    <div class="editor-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                        <div>
                            <h2 id="addSiteTitle" style="margin: 0;">Add New Site</h2>
                            <p style="color: var(--text-muted); margin: 0.5rem 0 0 0;">Configure a new protected site</p>
                        </div>
                        <div style="display: flex; gap: 1rem;">
                            <button class="btn-secondary" onclick="navigateToPage('sites')">
                                <span>‚Üê</span>
                                <span>Back to Sites</span>
                            </button>
                            <button class="btn-primary" onclick="saveNewSite()">
                                <span>üíæ</span>
                                <span>Add Site</span>
                            </button>
                        </div>
                    </div>

                    <!-- Add Site Tabs -->
                    <div class="tabs-container" style="margin-bottom: 2rem;">
                        <div class="tabs">
                            <button class="tab-btn active" data-add-tab="general">General</button>
                            <button class="tab-btn" data-add-tab="security">Security</button>
                            <button class="tab-btn" data-add-tab="ssl">SSL/TLS</button>
                        </div>
                    </div>

                    <!-- Add Site Content -->
                    <div id="addSiteContent"></div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <div class="modal" id="addSiteModal">
        <div class="modal-content" style="max-width: 700px; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header">
                <h3>Add New Site</h3>
                <button class="modal-close" onclick="closeModal('addSiteModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Domain *</label>
                    <input type="text" id="siteDomain" placeholder="example.com" class="form-input">
                </div>
                <div class="form-group">
                    <label>Backend URL *</label>
                    <input type="text" id="siteBackend" placeholder="http://10.0.0.100:8080" class="form-input">
                    <small style="color: var(--text-muted);">Primary backend server</small>
                </div>
                
                <hr style="border-color: var(--border-color); margin: 1.5rem 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 1rem;">üîí Security Settings</h4>
                
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="siteSSL" checked>
                        <span>Enable SSL/TLS</span>
                    </label>
                </div>
                
                <div class="form-group" id="sslChallengeTypeGroup">
                    <label>SSL Certificate Type</label>
                    <select id="sslChallengeType" class="form-input">
                        <option value="http-01">Let's Encrypt (HTTP Challenge)</option>
                        <option value="dns-01">Let's Encrypt (DNS Challenge)</option>
                        <option value="snakeoil">Self-Signed (Snakeoil)</option>
                        <option value="custom">Custom Certificate</option>
                    </select>
                    <small style="color: var(--text-muted); display: block; margin-top: 0.25rem;">
                        Snakeoil: Quick start with self-signed cert (not for production)
                    </small>
                </div>
                
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="siteModSec" checked>
                        <span>Enable ModSecurity WAF</span>
                    </label>
                </div>
                
                <div class="form-group">
                    <label>Rate Limit</label>
                    <select id="siteRateLimit" class="form-input" onchange="toggleCustomRateLimit()">
                        <option value="general">General (10 req/s)</option>
                        <option value="strict">Strict (5 req/s)</option>
                        <option value="api">API (20 req/s)</option>
                        <option value="custom">Custom</option>
                    </select>
                </div>
                
                <div class="form-group" id="customRateLimitGroup" style="display: none;">
                    <label>Custom Rate Limit (req/s)</label>
                    <input type="number" id="siteCustomRateLimit" placeholder="15" class="form-input" min="1" max="1000">
                </div>
                
                <hr style="border-color: var(--border-color); margin: 1.5rem 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 1rem;">üåç GeoIP Blocking</h4>
                
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="siteGeoIP" onchange="toggleGeoIPConfig()">
                        <span>Enable GeoIP Blocking</span>
                    </label>
                </div>
                
                <div id="geoipConfigGroup" style="display: none;">
                    <div class="form-group">
                        <label>Blocked Countries (ISO codes, comma-separated)</label>
                        <input type="text" id="siteBlockedCountries" placeholder="CN,RU,KP" class="form-input">
                        <small style="color: var(--text-muted);">Leave empty to allow all</small>
                    </div>
                    <div class="form-group">
                        <label>Allowed Countries (optional, overrides blocked)</label>
                        <input type="text" id="siteAllowedCountries" placeholder="US,GB,DE" class="form-input">
                    </div>
                </div>
                
                <hr style="border-color: var(--border-color); margin: 1.5rem 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 1rem;">üåç GeoIP Blocking</h4>
                
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="siteGeoIPEnabled">
                        <span>Enable GeoIP Blocking</span>
                    </label>
                    <small style="color: var(--text-muted); display: block; margin-top: 0.5rem;">
                        Block or allow access based on visitor's country
                    </small>
                </div>
                
                <div class="form-group">
                    <label>Blocked Countries (ISO codes, comma-separated)</label>
                    <input type="text" id="siteGeoBlockedCountries" placeholder="CN,RU,KP" class="form-input">
                    <small style="color: var(--text-muted);">
                        Common codes: CN (China), RU (Russia), KP (North Korea), IR (Iran), VN (Vietnam)
                        <br>Full list: <a href="https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2" target="_blank" style="color: var(--primary-color);">ISO 3166-1 alpha-2</a>
                    </small>
                </div>
                
                <hr style="border-color: var(--border-color); margin: 1.5rem 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 1rem;">üõ°Ô∏è Access Control</h4>
                
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="siteBasicAuth" onchange="toggleBasicAuth()">
                        <span>Enable Basic Authentication</span>
                    </label>
                </div>
                
                <div id="basicAuthGroup" style="display: none;">
                    <div class="form-group">
                        <label>Username</label>
                        <input type="text" id="siteAuthUser" placeholder="admin" class="form-input">
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="siteAuthPass" placeholder="password" class="form-input">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>IP Whitelist (comma-separated, optional)</label>
                    <input type="text" id="siteIPWhitelist" placeholder="192.168.1.0/24, 10.0.0.5" class="form-input">
                    <small style="color: var(--text-muted);">Only these IPs can access if set</small>
                </div>
                
                <hr style="border-color: var(--border-color); margin: 1.5rem 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 1rem;">‚ö° Performance & Compression</h4>
                
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="siteGzip" checked>
                        <span>Enable Gzip Compression</span>
                    </label>
                </div>
                
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="siteBrotli" checked>
                        <span>Enable Brotli Compression</span>
                    </label>
                </div>
                
                <div class="form-group">
                    <label>Compression Level (1-9)</label>
                    <input type="number" id="siteCompressionLevel" placeholder="6" class="form-input" min="1" max="9" value="6">
                    <small style="color: var(--text-muted);">Higher = better compression, more CPU</small>
                </div>
                
                <hr style="border-color: var(--border-color); margin: 1.5rem 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 1rem;">üíæ Caching</h4>
                
                                
                <hr style="border-color: var(--border-color); margin: 1.5rem 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 1rem;">ÔøΩ JavaScript Challenge (DDoS Protection)</h4>
                
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="siteChallengeEnabled">
                        <span>Enable JavaScript Challenge</span>
                    </label>
                    <small style="color: var(--text-muted); display: block; margin-top: 0.5rem;">
                        Requires visitors to solve a proof-of-work challenge before accessing the site. 
                        Protects against DDoS attacks and automated scraping.
                    </small>
                </div>
                
                <div class="form-group">
                    <label>Challenge Difficulty (12-24)</label>
                    <input type="range" id="siteChallengeDifficulty" min="12" max="24" value="18" class="form-range">
                    <div style="display: flex; justify-content: space-between; font-size: 0.875rem; color: var(--text-muted); margin-top: 0.5rem;">
                        <span>Easy (12)</span>
                        <span id="challengeDifficultyValue">Medium (18)</span>
                        <span>Hard (24)</span>
                    </div>
                    <small style="color: var(--text-muted); display: block; margin-top: 0.5rem;">
                        Higher difficulty increases protection but may affect user experience. 
                        Medium (18) takes ~1-3 seconds to solve on modern devices.
                    </small>
                </div>
                
                <div class="form-group">
                    <label>Challenge Duration (hours)</label>
                    <input type="number" id="siteChallengeDuration" placeholder="1" class="form-input" min="0.25" max="24" step="0.25" value="1">
                    <small style="color: var(--text-muted);">How long a solved challenge remains valid (default: 1 hour)</small>
                </div>
                
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="siteChallengeBypassCF" checked>
                        <span>Bypass Challenge for Cloudflare IPs</span>
                    </label>
                    <small style="color: var(--text-muted); display: block; margin-top: 0.5rem;">
                        Automatically bypass challenge for requests from Cloudflare's network (CF-Connecting-IP header)
                    </small>
                </div>
                
                <hr style="border-color: var(--border-color); margin: 1.5rem 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 1rem;">ÔøΩüñºÔ∏è Image Optimization</h4>
                
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="siteImageOpt" onchange="toggleImageOpt()">
                        <span>Enable Image Optimization</span>
                    </label>
                    <small style="color: var(--text-muted); display: block; margin-top: 0.25rem;">Resize and compress images on-the-fly</small>
                </div>
                
                <div id="imageOptGroup" style="display: none;">
                    <div class="form-group">
                        <label>JPEG Quality (1-100)</label>
                        <input type="number" id="siteImageQuality" placeholder="85" class="form-input" min="1" max="100" value="85">
                        <small style="color: var(--text-muted);">Lower = smaller files, lower quality</small>
                    </div>
                </div>
                
                <hr style="border-color: var(--border-color); margin: 1.5rem 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 1rem;">üì° Headers & Telemetry</h4>
                
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="siteWAFHeaders" checked>
                        <span>Add WAF Headers</span>
                    </label>
                    <small style="color: var(--text-muted); display: block; margin-top: 0.25rem;">X-Protected-By, X-WAF-Status, security headers</small>
                </div>
                
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="siteTelemetry" checked>
                        <span>Enable Telemetry</span>
                    </label>
                    <small style="color: var(--text-muted); display: block; margin-top: 0.25rem;">X-Request-ID, X-Response-Time, X-Backend-Server</small>
                </div>
                
                <div class="form-group">
                    <label>Custom Headers (one per line, format: "Header-Name value")</label>
                    <textarea id="siteCustomHeaders" placeholder="X-Custom-Header custom-value&#10;X-Another-Header another-value" class="form-input" rows="3"></textarea>
                    <small style="color: var(--text-muted);">Additional headers to add to responses</small>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal('addSiteModal')">Cancel</button>
                <button class="btn-primary" onclick="addSite()">Add Site</button>
            </div>
        </div>
    </div>

    <div class="modal" id="banModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Ban IP Address</h3>
                <button class="modal-close" onclick="closeModal('banModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>IP Address</label>
                    <input type="text" id="banIp" placeholder="192.168.1.100" class="form-input">
                </div>
                <div class="form-group">
                    <label>Reason</label>
                    <input type="text" id="banReason" placeholder="Manual ban - suspicious activity" class="form-input">
                </div>
                <div class="form-group">
                    <label>Duration (seconds)</label>
                    <input type="number" id="banDuration" value="3600" class="form-input">
                </div>
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="banPermanent">
                        <span>Permanent Ban</span>
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal('banModal')">Cancel</button>
                <button class="btn-primary" onclick="banIp()">Ban IP</button>
            </div>
        </div>
    </div>

    <!-- Import Sites Modal -->
    <div class="modal" id="importModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Import Sites</h3>
                <button class="modal-close" onclick="closeModal('importModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Import Mode</label>
                    <select id="importMode" class="form-input">
                        <option value="merge">Merge (Update existing, add new)</option>
                        <option value="skip_existing">Skip Existing (Only add new)</option>
                        <option value="replace">Replace All (‚ö†Ô∏è Deletes existing sites)</option>
                    </select>
                    <small style="color: var(--text-muted); margin-top: 0.5rem; display: block;">
                        <strong>Merge:</strong> Updates existing sites and adds new ones<br>
                        <strong>Skip:</strong> Only imports sites that don't exist<br>
                        <strong>Replace:</strong> Backs up and replaces all sites (‚ö†Ô∏è Use with caution!)
                    </small>
                </div>
                <div class="form-group">
                    <label>JSON File or Paste JSON</label>
                    <input type="file" id="importFile" accept=".json" class="form-input" onchange="handleImportFile(event)">
                    <small style="color: var(--text-muted); margin: 0.5rem 0; display: block;">OR paste JSON below:</small>
                    <textarea id="importJson" placeholder='{"version": "1.0", "sites": [...]}' class="form-input" rows="10" style="font-family: monospace; font-size: 0.875rem;"></textarea>
                </div>
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="importDryRun">
                        <span>Dry Run (Preview changes without importing)</span>
                    </label>
                </div>
                <div id="importPreview" style="display: none; margin-top: 1rem; padding: 1rem; background: var(--bg-secondary); border-radius: 0.5rem;">
                    <h4 style="margin: 0 0 0.5rem 0; font-size: 0.875rem;">Preview:</h4>
                    <pre id="importPreviewContent" style="margin: 0; font-size: 0.75rem; color: var(--text-muted); max-height: 200px; overflow-y: auto;"></pre>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal('importModal')">Cancel</button>
                <button class="btn-primary" onclick="importSites()">Import</button>
            </div>
        </div>
    </div>

    <!-- Add/Edit Block Rule Modal -->
    <div class="modal" id="blockRuleModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="blockRuleModalTitle">Add Block Rule</h3>
                <button class="modal-close" onclick="closeModal('blockRuleModal')">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="blockRuleId">
                <div class="form-group">
                    <label>Rule Name *</label>
                    <input type="text" id="blockRuleName" placeholder="Block .git directory" class="form-input" required>
                    <small style="color: var(--text-muted);">Friendly name for this rule</small>
                </div>
                <div class="form-group">
                    <label>Path Pattern *</label>
                    <input type="text" id="blockRulePattern" placeholder="/.git/" class="form-input" required>
                    <small style="color: var(--text-muted);">
                        Examples: <code>/.git/config</code>, <code>/.env</code>, <code>/admin/*</code>, <code>.sql</code>
                    </small>
                </div>
                <div class="form-group">
                    <label>Pattern Type</label>
                    <select id="blockRulePatternType" class="form-input">
                        <option value="exact">Exact Match (/.git/config)</option>
                        <option value="prefix">Starts With (/.git/)</option>
                        <option value="suffix">Ends With (.sql)</option>
                        <option value="contains">Contains (/admin/)</option>
                        <option value="regex">Regular Expression</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Severity</label>
                    <select id="blockRuleSeverity" class="form-input">
                        <option value="CRITICAL">Critical</option>
                        <option value="WARNING">Warning</option>
                        <option value="NOTICE">Notice</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Block Message</label>
                    <input type="text" id="blockRuleMessage" placeholder="Access to this path is forbidden" class="form-input" value="Access to this path is forbidden">
                    <small style="color: var(--text-muted);">Message shown in security events</small>
                </div>
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="blockRuleEnabled" checked>
                        <span>Enable this rule</span>
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal('blockRuleModal')">Cancel</button>
                <button class="btn-primary" onclick="saveBlockRule()">Save Rule</button>
            </div>
        </div>
    </div>

    <!-- Add/Edit Bot Rule Modal -->
    <div class="modal" id="botRuleModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="botRuleModalTitle">Add Bot Rule</h3>
                <button class="modal-close" onclick="closeModal('botRuleModal')">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="botRuleId">
                <div class="form-group">
                    <label>Bot Pattern (User-Agent) *</label>
                    <input type="text" id="botRulePattern" placeholder="~*googlebot" class="form-input" required>
                    <small style="color: var(--text-muted);">
                        Use nginx regex format. Examples: <code>~*googlebot</code>, <code>~*bingbot</code>, <code>~*facebookexternalhit</code><br>
                        <code>~*</code> = case-insensitive, <code>~</code> = case-sensitive
                    </small>
                </div>
                <div class="form-group">
                    <label>Action *</label>
                    <select id="botRuleAction" class="form-input" required>
                        <option value="allow">Allow - Let bot pass through</option>
                        <option value="flag">Flag - Allow but log as suspicious</option>
                        <option value="block">Block - Reject with 403</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Priority *</label>
                    <input type="number" id="botRulePriority" class="form-input" value="100" min="1" max="999" required>
                    <small style="color: var(--text-muted);">
                        Lower numbers = higher priority. Good bots: 10-50, Neutral: 100-150, Bad bots: 200-250
                    </small>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <input type="text" id="botRuleDescription" placeholder="Google Search Bot" class="form-input">
                    <small style="color: var(--text-muted);">Friendly name for this bot rule</small>
                </div>
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="botRuleEnabled" checked>
                        <span>Enable this rule</span>
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal('botRuleModal')">Cancel</button>
                <button class="btn-primary" onclick="saveBotRule()">Save Rule</button>
            </div>
        </div>
    </div>

    <!-- Traffic Analysis Modal -->
    <div class="modal" id="trafficAnalysisModal" style="display: none;">
        <div class="modal-content" style="max-width: 1200px; width: 95%;">
            <div class="modal-header">
                <h3>üìä Traffic Analysis - <span id="analysisHour"></span></h3>
                <button class="modal-close" onclick="closeModal('trafficAnalysisModal')">&times;</button>
            </div>
            <div class="modal-body" style="max-height: 80vh; overflow-y: auto;">
                
                <!-- Summary Cards -->
                <div class="stats-grid" style="margin-bottom: 20px;">
                    <div class="stat-card">
                        <div class="stat-label">Total Requests</div>
                        <div class="stat-value" id="analysisTotalRequests">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Unique Domains</div>
                        <div class="stat-value" id="analysisUniqueDomains">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Unique IPs</div>
                        <div class="stat-value" id="analysisUniqueIps">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Avg Response</div>
                        <div class="stat-value" id="analysisAvgResponse">0ms</div>
                    </div>
                </div>

                <!-- Charts Row -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h4>Traffic by Domain</h4>
                        </div>
                        <div style="height: 250px; position: relative;">
                            <canvas id="analysisDomainChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-card">
                        <div class="chart-header">
                            <h4>Status Code Distribution</h4>
                        </div>
                        <div style="height: 250px; position: relative;">
                            <canvas id="analysisStatusChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Tabs for detailed data -->
                <div class="tabs" style="margin-bottom: 20px;">
                    <button class="tab-button active" onclick="switchAnalysisTab('endpoints')">Top Endpoints</button>
                    <button class="tab-button" onclick="switchAnalysisTab('errors')">Errors</button>
                    <button class="tab-button" onclick="switchAnalysisTab('ips')">Top IPs</button>
                    <button class="tab-button" onclick="switchAnalysisTab('bots')">Bot Activity</button>
                </div>

                <!-- Tab Content -->
                <div id="analysisTabEndpoints" class="analysis-tab-content">
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Domain</th>
                                    <th>Path</th>
                                    <th>Hits</th>
                                    <th>Avg Response</th>
                                </tr>
                            </thead>
                            <tbody id="analysisEndpointsBody">
                                <tr><td colspan="4" style="text-align: center;">Loading...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div id="analysisTabErrors" class="analysis-tab-content" style="display: none;">
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Domain</th>
                                    <th>Path</th>
                                    <th>Status</th>
                                    <th>Count</th>
                                </tr>
                            </thead>
                            <tbody id="analysisErrorsBody">
                                <tr><td colspan="4" style="text-align: center;">Loading...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div id="analysisTabIps" class="analysis-tab-content" style="display: none;">
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>IP Address</th>
                                    <th>Requests</th>
                                    <th>404s</th>
                                    <th>Blocked</th>
                                    <th>Unique Paths</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="analysisIpsBody">
                                <tr><td colspan="6" style="text-align: center;">Loading...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div id="analysisTabBots" class="analysis-tab-content" style="display: none;">
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Bot Name</th>
                                    <th>Type</th>
                                    <th>Action</th>
                                    <th>Detections</th>
                                    <th>Unique IPs</th>
                                </tr>
                            </thead>
                            <tbody id="analysisBotsBody">
                                <tr><td colspan="5" style="text-align: center;">Loading...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="toast.js?v=2"></script>
    <script src="app.js?v=5"></script>
</body>
</html>
